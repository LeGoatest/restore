<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DropZone System Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .demo-layout {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .sidebar {
            width: 200px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        .canvas {
            flex: 1;
            background: #fff;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            min-height: 400px;
            padding: 20px;
        }
        .primitive-item {
            display: block;
            width: 100%;
            padding: 8px 12px;
            margin: 5px 0;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: grab;
            text-align: left;
            font-size: 14px;
        }
        .primitive-item:hover {
            background: #005a87;
        }
        .primitive-item:active {
            cursor: grabbing;
        }
        .scroller {
            max-height: 600px;
            overflow-y: auto;
        }
        /* Prismic-style CSS */
        .widget {
            margin: 10px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
            position: relative;
        }
        .widget header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .fieldLabel {
            font-weight: 600;
            color: #333;
        }
        .field-key {
            font-size: 12px;
            color: #666;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .builder_actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }
        .builder_actions svg {
            cursor: pointer;
            opacity: 0.6;
        }
        .builder_actions svg:hover {
            opacity: 1;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 14px;
        }
        /* Dropzone styles */
        .dropzone {
            transition: all 0.2s ease-in-out;
            border-radius: 4px;
            position: relative;
        }
        .dropzone-active {
            opacity: 1 !important;
        }
        .dropzone-drag-over {
            background-color: rgba(0, 124, 186, 0.1) !important;
            border: 2px dashed #007cba !important;
        }
        .dropzone-inserting {
            animation: pulse 0.3s ease-in-out;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .controls button {
            margin: 5px;
            padding: 8px 16px;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #005a87;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            background: #e8f4f8;
            border-left: 4px solid #007cba;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <h1>DropZone System Demo</h1>
        <p>This demo shows the dropzone system with visual feedback. Drag primitives from the sidebar to the canvas.</p>
        
        <div class="status" id="status">
            Ready - Drag primitives from the sidebar to create fields
        </div>

        <div class="controls">
            <button onclick="clearCanvas()">Clear Canvas</button>
            <button onclick="addSamplePrimitives()">Add Sample Primitives</button>
            <button onclick="toggleDropzoneVisibility()">Toggle Dropzone Visibility</button>
        </div>

        <div class="demo-layout">
            <div class="sidebar">
                <h3>Primitives</h3>
                <div class="primitive-item" draggable="true" data-primitive-type="text">
                    üìù Text Field
                </div>
                <div class="primitive-item" draggable="true" data-primitive-type="textarea">
                    üìÑ Textarea
                </div>
                <div class="primitive-item" draggable="true" data-primitive-type="rich_text">
                    üìù Rich Text
                </div>
                <div class="primitive-item" draggable="true" data-primitive-type="boolean">
                    ‚òëÔ∏è Boolean
                </div>
                <div class="primitive-item" draggable="true" data-primitive-type="image">
                    üñºÔ∏è Image
                </div>
                <div class="primitive-item" draggable="true" data-primitive-type="select">
                    üìã Select
                </div>
                <div class="primitive-item" draggable="true" data-primitive-type="date">
                    üìÖ Date
                </div>
                <div class="primitive-item" draggable="true" data-primitive-type="number">
                    üî¢ Number
                </div>
            </div>

            <div class="canvas">
                <div class="scroller">
                    <article data-mask="demo-block">
                        <div data-section="Main" data-model-path="Main" class="active" id="canvas-main">
                            <!-- Dropzones and primitives will be inserted here -->
                        </div>
                    </article>
                </div>
            </div>
        </div>
    </div>

    <script src="../src/BlockBuilder/PrimitiveRenderer.js"></script>
    <script src="../src/BlockBuilder/DropZoneManager.js"></script>
    <script>
        let renderer, dropZoneManager;
        let primitiveCounter = 0;

        function initializeDemo() {
            const canvas = document.getElementById('canvas-main');
            renderer = new PrimitiveRenderer();
            dropZoneManager = new DropZoneManager(canvas);

            // Set up sidebar drag events
            setupSidebarDragEvents();
            
            // Listen for drop events
            setupDropEventListeners();

            updateStatus('Demo initialized - Ready to drag primitives');
        }

        function setupSidebarDragEvents() {
            const primitiveItems = document.querySelectorAll('.primitive-item');
            
            primitiveItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    const primitiveType = item.dataset.primitiveType;
                    e.dataTransfer.setData('text/plain', primitiveType);
                    e.dataTransfer.effectAllowed = 'copy';
                    
                    // Add visual feedback to dragged item
                    item.style.opacity = '0.5';
                    updateStatus(`Dragging ${primitiveType} primitive`);
                });

                item.addEventListener('dragend', (e) => {
                    item.style.opacity = '1';
                });
            });
        }

        function setupDropEventListeners() {
            // Listen for primitive drop events
            document.addEventListener('primitiveDropped', (e) => {
                const { primitiveType, dropzone, insertionIndex } = e.detail;
                createPrimitiveAtDropzone(primitiveType, dropzone);
            });

            // Listen for primitive reorder events
            document.addEventListener('primitiveReordered', (e) => {
                const { element, dropzone, oldPosition, newPosition } = e.detail;
                reorderPrimitive(element, dropzone, oldPosition, newPosition);
            });
        }

        function createPrimitiveAtDropzone(primitiveType, dropzone) {
            primitiveCounter++;
            
            const config = {
                apiId: `${primitiveType}_${primitiveCounter}`,
                name: `${primitiveType}_${primitiveCounter}`,
                label: `${primitiveType.charAt(0).toUpperCase() + primitiveType.slice(1)} Field ${primitiveCounter}`,
                placeholder: `Enter ${primitiveType}...`
            };

            try {
                const primitiveElement = renderer.renderPrimitive(primitiveType, config, primitiveCounter);
                dropZoneManager.insertPrimitiveAtDropZone(primitiveElement, dropzone);
                
                updateStatus(`Created ${primitiveType} primitive at position ${dropzone.dataset.position}`);
                
                // Dispatch primitive created event
                document.dispatchEvent(new CustomEvent('primitiveCreated', {
                    detail: { element: primitiveElement, config }
                }));
                
            } catch (error) {
                updateStatus(`Error creating ${primitiveType}: ${error.message}`, 'error');
            }
        }

        function reorderPrimitive(element, dropzone, oldPosition, newPosition) {
            dropZoneManager.insertPrimitiveAtDropZone(element, dropzone);
            updateStatus(`Moved primitive from position ${oldPosition} to ${newPosition}`);
        }

        function clearCanvas() {
            const canvas = document.getElementById('canvas-main');
            const primitives = canvas.querySelectorAll('.widget');
            primitives.forEach(primitive => primitive.remove());
            
            dropZoneManager.updateDropZones();
            primitiveCounter = 0;
            updateStatus('Canvas cleared');
        }

        function addSamplePrimitives() {
            const samplePrimitives = [
                { type: 'text', label: 'Page Title' },
                { type: 'textarea', label: 'Description' },
                { type: 'boolean', label: 'Is Published' }
            ];

            const canvas = document.getElementById('canvas-main');
            const startDropzone = dropZoneManager.getDropZone('start');

            samplePrimitives.forEach((sample, index) => {
                primitiveCounter++;
                const config = {
                    apiId: sample.type + '_' + primitiveCounter,
                    name: sample.type + '_' + primitiveCounter,
                    label: sample.label,
                    placeholder: `Enter ${sample.label.toLowerCase()}...`
                };

                const primitiveElement = renderer.renderPrimitive(sample.type, config, primitiveCounter);
                canvas.appendChild(primitiveElement);
            });

            dropZoneManager.updateDropZones();
            updateStatus('Added sample primitives');
        }

        function toggleDropzoneVisibility() {
            const dropzones = dropZoneManager.getAllDropZones();
            const isVisible = dropzones[0]?.style.opacity === '1';
            
            if (isVisible) {
                dropZoneManager.hideDropZones();
                updateStatus('Dropzones hidden');
            } else {
                dropZoneManager.showDropZones();
                updateStatus('Dropzones shown');
            }
        }

        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.backgroundColor = type === 'error' ? '#ffe6e6' : '#e8f4f8';
            status.style.borderLeftColor = type === 'error' ? '#dc3545' : '#007cba';
        }

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', initializeDemo);

        // Add basic SVG icons
        document.body.insertAdjacentHTML('beforeend', `
            <svg style="display: none;">
                <defs>
                    <g id="md-delete">
                        <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                    </g>
                    <g id="md-settings">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.82,11.69,4.82,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </g>
                    <g id="md-drag-handle">
                        <path d="M20 9H4v2h16V9zM4 15h16v-2H4v2z"/>
                    </g>
                </defs>
            </svg>
        `);
    </script>
</body>
</html>