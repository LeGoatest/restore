<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Textarea and Rich Text Placeholder Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .demo-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .demo-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        /* Prismic-style widget styling */
        .widget {
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: white;
            margin-bottom: 20px;
            position: relative;
        }

        .widget header {
            padding: 12px 16px;
            border-bottom: 1px solid #e0e0e0;
            background: #fafafa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .fieldLabel {
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .field-key {
            font-size: 12px;
            color: #666;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .builder_actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
        }

        .builder_actions .icon {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .builder_actions .icon:hover {
            opacity: 1;
        }

        /* Textarea styling */
        .Text_wrapper {
            padding: 16px;
        }

        .expanding-wrapper {
            position: relative;
        }

        .expanding {
            width: 100%;
            min-height: 80px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }

        .expanding:focus {
            outline: none;
            border-color: #4285f4;
            box-shadow: 0 0 0 2px rgba(66, 133, 244, 0.2);
        }

        /* Rich Text styling */
        .widget-StructuredText {
            position: relative;
        }

        .editor-placeholder {
            position: absolute;
            top: 60px;
            left: 16px;
            right: 16px;
            pointer-events: none;
            color: #999;
            font-style: italic;
            z-index: 1;
        }

        .show-placeholder .editor-placeholder {
            display: block;
        }

        .editor-placeholder {
            display: none;
        }

        .ProseMirror {
            min-height: 100px;
            padding: 16px;
            border: none;
            outline: none;
            font-size: 14px;
            line-height: 1.5;
        }

        .ProseMirror:focus {
            background: #fafafa;
        }

        .ProseMirror p {
            margin: 0 0 8px 0;
        }

        .ProseMirror p:last-child {
            margin-bottom: 0;
        }

        /* Demo controls */
        .demo-controls {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .demo-controls button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 5px;
        }

        .demo-controls button:hover {
            background: #3367d6;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            background: #e8f5e8;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>Textarea and Rich Text Placeholder System Demo</h1>
    
    <div class="demo-container">
        <div class="demo-title">Textarea Primitive with Placeholder System</div>
        <div id="textarea-demo"></div>
        <div class="demo-controls">
            <button onclick="clearTextarea()">Clear Content</button>
            <button onclick="addTextareaContent()">Add Content</button>
            <button onclick="changePlaceholder('textarea')">Change Placeholder</button>
            <div class="status" id="textarea-status">Placeholder should show when empty and not focused</div>
        </div>
    </div>

    <div class="demo-container">
        <div class="demo-title">Rich Text Primitive with Placeholder System</div>
        <div id="richtext-demo"></div>
        <div class="demo-controls">
            <button onclick="clearRichText()">Clear Content</button>
            <button onclick="addRichTextContent()">Add Content</button>
            <button onclick="changePlaceholder('richtext')">Change Placeholder</button>
            <div class="status" id="richtext-status">Placeholder should show when empty and not focused</div>
        </div>
    </div>

    <!-- Include the required JavaScript files -->
    <script src="../src/BlockBuilder/PlaceholderSystem.js"></script>
    <script src="../src/BlockBuilder/PrimitiveRenderer.js"></script>

    <script>
        // Initialize the renderer and demo
        let renderer;
        let textareaElement;
        let richTextElement;

        function initializeDemo() {
            renderer = new PrimitiveRenderer();

            // Create textarea primitive
            const textareaConfig = {
                apiId: 'description',
                name: 'description',
                label: 'Description',
                placeholder: 'Enter your description here...'
            };
            textareaElement = renderer.renderPrimitive('textarea', textareaConfig, 0);
            document.getElementById('textarea-demo').appendChild(textareaElement);

            // Create rich text primitive
            const richTextConfig = {
                apiId: 'content',
                name: 'content',
                label: 'Rich Text Content',
                placeholder: 'Start typing your rich text content...'
            };
            richTextElement = renderer.renderPrimitive('rich_text', richTextConfig, 1);
            document.getElementById('richtext-demo').appendChild(richTextElement);

            // Add event listeners to monitor changes
            setupEventListeners();
        }

        function setupEventListeners() {
            // Textarea events
            const textarea = textareaElement.querySelector('textarea.expanding');
            if (textarea) {
                textarea.addEventListener('input', () => updateStatus('textarea'));
                textarea.addEventListener('focus', () => updateStatus('textarea'));
                textarea.addEventListener('blur', () => updateStatus('textarea'));
            }

            // Rich text events
            const proseMirror = richTextElement.querySelector('.ProseMirror');
            if (proseMirror) {
                proseMirror.addEventListener('input', () => updateStatus('richtext'));
                proseMirror.addEventListener('focus', () => updateStatus('richtext'));
                proseMirror.addEventListener('blur', () => updateStatus('richtext'));
            }
        }

        function updateStatus(type) {
            setTimeout(() => {
                if (type === 'textarea') {
                    const textarea = textareaElement.querySelector('textarea.expanding');
                    const hasContent = textarea.value.trim().length > 0;
                    const isFocused = document.activeElement === textarea;
                    const placeholderVisible = textarea.style.color === 'rgb(153, 153, 153)';
                    
                    document.getElementById('textarea-status').innerHTML = 
                        `Content: ${hasContent ? 'Yes' : 'No'} | ` +
                        `Focused: ${isFocused ? 'Yes' : 'No'} | ` +
                        `Placeholder Style: ${placeholderVisible ? 'Visible' : 'Hidden'}`;
                } else if (type === 'richtext') {
                    const proseMirror = richTextElement.querySelector('.ProseMirror');
                    const hasContent = renderer.placeholderSystem.hasRichTextContent(proseMirror);
                    const isFocused = document.activeElement === proseMirror;
                    const placeholderVisible = richTextElement.classList.contains('show-placeholder');
                    
                    document.getElementById('richtext-status').innerHTML = 
                        `Content: ${hasContent ? 'Yes' : 'No'} | ` +
                        `Focused: ${isFocused ? 'Yes' : 'No'} | ` +
                        `Placeholder Visible: ${placeholderVisible ? 'Yes' : 'No'}`;
                }
            }, 10);
        }

        function clearTextarea() {
            const textarea = textareaElement.querySelector('textarea.expanding');
            textarea.value = '';
            textarea.blur();
            renderer.placeholderSystem.updatePlaceholderVisibility(textareaElement);
            updateStatus('textarea');
        }

        function addTextareaContent() {
            const textarea = textareaElement.querySelector('textarea.expanding');
            textarea.value = 'This is some sample content for the textarea field.';
            renderer.placeholderSystem.updatePlaceholderVisibility(textareaElement);
            updateStatus('textarea');
        }

        function clearRichText() {
            const proseMirror = richTextElement.querySelector('.ProseMirror');
            proseMirror.innerHTML = '<p><br></p>';
            proseMirror.blur();
            renderer.placeholderSystem.updatePlaceholderVisibility(richTextElement);
            updateStatus('richtext');
        }

        function addRichTextContent() {
            const proseMirror = richTextElement.querySelector('.ProseMirror');
            proseMirror.innerHTML = '<p>This is <strong>rich text</strong> content with <em>formatting</em>.</p>';
            renderer.placeholderSystem.updatePlaceholderVisibility(richTextElement);
            updateStatus('richtext');
        }

        function changePlaceholder(type) {
            const newPlaceholder = prompt(`Enter new placeholder text for ${type}:`);
            if (newPlaceholder) {
                if (type === 'textarea') {
                    renderer.placeholderSystem.setPlaceholderText(textareaElement, newPlaceholder);
                    updateStatus('textarea');
                } else if (type === 'richtext') {
                    renderer.placeholderSystem.setPlaceholderText(richTextElement, newPlaceholder);
                    updateStatus('richtext');
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeDemo);
    </script>
</body>
</html>